# System Design HW 1
## Домашнее задание №1. Социальная сеть для путешествеников

[Задание из курса System Design](https://balun.courses/courses/system_design)

## Задание:

- Необходимо формализовать функциональные и нефункциональные требовния к системе
- Оценить загрузку на приложение

## Функциональные требования:
- Существует регистрация пользователй, авторизация пользователей  
-  Пользователи имеют возможность подписываться на новости как определенных людей, так и на конкретные страны/места
- Отображение постов пользователей, на которые оформлена подписка будет в обратном хронологическом порядке
- Есть возможность в одном посте прикреплять фото, добавлять геометку и указывать геопозицию
- У поста будут также два параметра: кол-во просмотров, кол-во лайков
- Существует посик авторов постов и возможность подписыватсья на них, а также отписываться
- Существует раздел, в котором пользователю будут предложены посты, авторы, места, которые были самые просматреваемые за последние 24 часа
- Помимо просмотра ленты, пользователь может просматриввать все посты определенного автора

## Нефункциональные требования:
- DAU - 10 000 000
- В среднем на одного пользователя будет создаваться один пост и писатся 3 коментария
- Регион пользователей: СНГ
- В "сезон отпусков" вторая половина лета - сентябрь будет повышатсья кол-во уникальных пользователей в день от 15% до 25%
- Все данные (юзеры, их посты и коменты) храняться всегда
- Новый пост подписчики могут увидеть не позже чем за 30 секнуд после нажатия автором кнопки опубликовать.
- Система может быть недоступна не более 10 часов в год
- Система должна работаь на мобиле и в браузере

## Оценка нагрузки
- DAU = 10 000 000  Предположим, что в среднем в сутки пользвоатель будет загружать один пост в день, писать 5 коментариев, читать 7 авторов в день и читать ленту 10 раз в день 
Тогда средний RPS будет следующим:
```
Посты
 RPS = 10 000 000 * 1 / 86400 = 115 (запись)
 // Один пост в среднем весит 1Мб 
 Traffic = 115 * 1Мб = 115Мб/с
 Объем диска для постов
 Сapacity = 115 Мб/с * 86400 * 365 = 3626 Тб
 Кол-во дисков:
 3700 / 100 = 37
 
 RPS чтений страниц авторов
 RPS = 10 000 000 * 7 / 86400 = 810 (чтение)
 Traffic = 810 *[ 30 (среднее кол-во постов) * 1Мб + 512Кб (информация о юзере) ]= 24705 Мб/с = 24 Гб/с
 
 RPS создания новых страниц
 RPS = (10 000 000 / 365) / 86400 = 0,31 (запись)
 Traffic = 0,31 * 512Кб = 158 Кб/с
 Объем диска для авторов
 Capacity = 158Кб/с * 86400 * 365 = 5Тб
 
 RPS чтений ленты
 PRS = 10 000 000 * 10 / 86400 = 1200 (чтение)
 Traffic = 1200 * 2МБ (пусть юзер смотрит в реднем 2 поста в секунду) = 2400 Мб/с = 2,5Гб/с
```
Исходня из этих данных система будет чаще всего использоваться на чтение, чем на запись, а самый нагруженный сегмент системы - страничка авторов новостей.

Потребуется памяти:
```
10 000 000 пользователей из которых будет 1 000 000 аткивынх авторов, у которых в среднем будет 30 постов в ленте
```
Тогда всего памяти нам понадобится
```
9 000 000 * 1,5Мб + 1 000 000 * 31 = 45Тб
```

Количество одновременных соединений:
```
Connections = 10 000 000 * 0.1 = 1 000 000
```

Потребуется дисков:
```
Disks = 3700Тб/ 100 (один сата диск) = 37 дисков
```

## База данных
### Посты
Партиционирование по времени (одна табличка будет для постов за каждые 24ч)
Хостов: 37/10 = 4
Репликация master-slave, sync, RF = 3
Шардирование: да. Распределение данных между шардами с помощью hash по id
Итого хостов с учетом репликации должно быть: 12

Партиционированние нужно, чтобы подгружать пользователю посты только за 24ч, чтобы не делать запросов всей бд записей сразу.
Шардирование используется, так как имеется большое кол-во данных на большом кол-ве хостов. Кол-во шардов == кол-во хостов
Репликация асинхронная, кратковременное разночтение клиентами не критично

### Пользователи
Хостов: 1
Репликация:master-slave,sync, RF=3. Хостов с учетом реплиаций = 3
Шардирование: да. Шардов будет 3. Распределяться по hash от id
Итого хостов с учетом репликации: 9

Партиционирование нужно, чтобы быстрее выдавать пользователю активных юзеров, которые делают часто посты. Хостов 3, так как информация о юзере мало занимает диска. 
Репликация синхронная, чтобы обеспечить строгую консистентность данных.
Шардирование используется для распределения данных на дисках
